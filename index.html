<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Smart Plant Pot</title>
<script src="https://unpkg.com/mqtt/dist/mqtt.min.js"></script>
<!-- <script src="https://cdn.jsdelivr.net/npm/chart.js"></script> -->
<style>
  body{font-family:sans-serif;background:#0f172a;color:#e5e7eb;margin:0}
  header{padding:1rem;text-align:center;font-weight:700}
  .grid{display:grid;gap:1rem;padding:1rem;grid-template-columns:repeat(auto-fit,minmax(220px,1fr))}
  .card{background:#111827;padding:1rem;border-radius:12px}
  .val{font-size:2rem;font-weight:bold}
  button{margin:.5rem;padding:.5rem 1rem;border-radius:8px;background:#1f2937;color:#e5e7eb;border:none}

  .gauges {
    display:flex;
    gap:2rem;
    justify-content:center;
    flex-wrap:wrap; /* stack on small screens */
    margin:1rem;
  }
  canvas {
    background:#111827;
    border-radius:12px;
    padding:0.5rem;
  }



</style>
</head>
<body>
<header>ðŸŒ± Smart Plant Pot Dashboard</header>

<div class="grid">
  <div class="card">Temp: <span id="temp" class="val">--</span> Â°C</div>
  <div class="card">Hum: <span id="hum" class="val">--</span> %</div>
  <div class="card">Soil: <span id="soil" class="val">--</span></div>
  <div class="card">Light: <span id="light" class="val">--</span></div>
</div>

<div style="text-align:center;margin:1rem">
  <button onclick="pump('ON')">ðŸ’§ Water ON</button>
  <button onclick="pump('OFF')">âœ– Water OFF</button>
</div>

<!-- <canvas id="chart" height="120"></canvas> -->
<div class="gauges">
<canvas id="tempGauge"
    data-type="linear-gauge"
    data-width="120"
    data-height="400"
    data-units="Â°C"
    data-min-value="0"
    data-max-value="50"
    data-major-ticks="0,5,10,15,20,25,30,35,40,45,50"
    data-value="20"
    data-color-bar-progress="red"
    data-color-bar="rgba(255,255,255,0.2)" ></canvas>

<canvas id="soilGauge"
    data-type="linear-gauge"
    data-width="120"
    data-height="400"
    data-units="Soil moisture"
    data-min-value="0"
    data-max-value="100"
    data-major-ticks=" "
    data-tick-side="none"
    data-number-side="none"
    data-color-bar-progress="blue"
    data-color-bar="rgba(56, 210, 224,0.2)"></canvas>
</div>

  <p id="soilLabel" style="text-align:center;font-size:1.2rem;font-weight:bold"></p>

<script src="https://cdn.jsdelivr.net/npm/canvas-gauges/gauge.min.js"></script>


<script>
const MQTT_HOST="4629ff2d3b384c748f95b499f10e4f5b.s1.eu.hivemq.cloud";
const MQTT_USER="hivemq.webclient.1755195003530"; // read+write restricted
const MQTT_PASS="8354ECQbTRgAeafh:%!$"; 
const TOPIC_SENS="plantpot/sensors";
const TOPIC_PUMP="plantpot/pump";

const client=mqtt.connect(`wss://${MQTT_HOST}:8884/mqtt`,{
  username:MQTT_USER,password:MQTT_PASS,clean:true,reconnectPeriod:2000
});

client.on("connect",()=>{client.subscribe(TOPIC_SENS);});

client.on("message",(t,m)=>{
  let d=JSON.parse(m.toString());
  document.getElementById("temp").textContent = (d.temp_c ?? "--");
  document.gauges.get('tempGauge').value = d.temp_c;
  document.getElementById("soilLabel").textContent = d.moistureValue ?? "--";
  document.getElementById("hum").textContent=d.humidity??"--";
  document.getElementById("soil").textContent=d.moistureValue??"--";
  document.getElementById("light").textContent=d.lightValue??"--";

  const gSoil = document.gauges?.get('soilGauge');
  if (gSoil) {
    let val = 0;
    if (d.moistureValue === "Very Wet") val = 100;
    else if (d.moistureValue === "Wet") val = 80;
    else if (d.moistureValue === "Moist") val = 40;
    else if (d.moistureValue === "Dry") val = 60;
    else if (d.moistureValue === "Very Dry") val = 20;
    gSoil.value = val;
  }
});

function pump(cmd){ client.publish(TOPIC_PUMP,cmd); }

// // Chart.js
// const ctx=document.getElementById("chart");
// const chart=new Chart(ctx,{type:"line",data:{labels:[],datasets:[{label:"Temp Â°C",data:[],borderColor:"red"}]},options:{scales:{x:{display:false}}}});
// function addPoint(v){if(!v)return;const t=new Date().toLocaleTimeString();chart.data.labels.push(t);chart.data.datasets[0].data.push(v);if(chart.data.labels.length>20){chart.data.labels.shift();chart.data.datasets[0].data.shift();}chart.update();}
</script>
</body>
</html>
